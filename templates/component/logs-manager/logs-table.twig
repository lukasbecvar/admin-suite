{% extends 'common/layout.twig' %}

{# LOG MANAGER TABLE #}
{% block component %} 
<div class="users-manager">
    <div class="bg-neutral-900 border-b border-neutral-700 sub-navigation">
        {# GO TO RAW LOGS DATABASE #}
        <a href="#" class="border border-neutral-500 font-bold px-1 text-white">
            <i class="fa fa-database" aria-hidden="true"></i>
        </a>

        {# SET ALL LOGS READED #}
        <a href={{ path('app_manager_logs_set_readed') }} class="border border-neutral-500 font-bold px-1 text-white">
            <i class="fa fa-check" aria-hidden="true"></i>
        </a>

        {# PAGE SUBTITLE #}
        <span class="mr-1 text-white phone-none">Logs: ({{ logsCount|e }})</span>

        {# FILTER FORM #}
        <span class="mr-1 phone-only"></span>
        <div>
            <form method="get" action={{ path('app_manager_logs') }}>
                <select name="filter" onchange="this.form.submit()" class="bg-neutral-800 text-white border border-neutral-500 rounded">
                    <option value="UNREADED">UNREADED</option>
                    <option value="READED" {% if filter == 'READED' %}selected{% endif %}>READED</option>
                    <option value="all" {% if filter == 'all' %}selected{% endif %}>ALL</option>
                </select>
            </form>
        </div>
    </div>

    {# CHECK IF LOGS NOT EMPTY #}
    {% if logsCount < 1 %}
        <p class="flex items-center justify-center mt-20 mb-20 text-2xl text-white font-bold">No relative logs were found</p>
    {% else %}
        {# LOG VIEW TABLE #}
        <div class="bg-neutral-900 border-b border-neutral-700 overflow-x-auto">
            <table class="min-w-full divide-y divide-white whitespace-nowrap">
                <thead>
                    <tr class="hover:bg-neutral-800 border-b border-neutral-600">
                        <th class="text-left text-white p-1">#</th>
                        <th class="text-left text-white p-1">Name</th>
                        <th class="text-left text-white p-1">Message</th>
                        <th class="text-left text-white p-1">Time</th>
                        <th class="text-left text-white p-1">Browser</th>
                        <th class="text-left text-white p-1">IP Address</th>
                        <th class="text-left text-white p-1">User</th>
                        {% if filter == 'UNREADED' %}
                            <th class="text-left text-white p-1"><i class="fa fa-check" aria-hidden="true"></th>
                        {% endif %}
                        </tr>
                </thead>
                <tbody class="divide-y divide-white font-medium">
                    {# LOG ROW #}
                    {% for row in logs %}
                        <tr class="hover:bg-neutral-800 border-b border-neutral-600">
                            {# LOG DATA #}
                            <td class="text-white p-1 border-b border-neutral-600">{{ row.id|e }}</td>
                            <td class="text-white p-1 border-b border-neutral-600">{{ row.name|e }}</td>
                            <td class="text-white p-1 border-b border-neutral-600">{{ row.message|e }}</td>
                            <td class="text-white p-1 border-b border-neutral-600">{{ row.time|date('Y-m-d H:i:s')|e }}</td>
                            <td class="text-white p-1 border-b border-neutral-600">{{ visitorInfoUtil.getBrowserShortify(row.userAgent)|e }}</td>
                            <td class="text-white p-1 border-b border-neutral-600">{{ row.ipAdderss|e }}</td>
                            <td class="text-white p-1 border-b border-neutral-600">{{ userManager.getUsernameById(row.userId)|e }}</td>

                            {# SET LOG READED LINK #}
                            {% if filter == 'UNREADED' %}
                                <td class="text-white p-1 border-b border-neutral-600">
                                    <a href={{ path('app_manager_logs_set_readed', {'id': row.id }) }} class="delete-button"><i class="fa fa-check" aria-hidden="true"></i></a>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div> 
    {% endif %}
</div> 
{% endblock %}
