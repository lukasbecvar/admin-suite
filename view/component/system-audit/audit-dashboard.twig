{% extends 'common/layout.twig' %}

{# SYSTEM AUDIT COMPONENT VIEW #}
{% block component %} 
{# SUB-NAVIGATION #}
<div class="bg-neutral-900 border-b border-neutral-800 sub-navigation breadcrumb">
    {# BACK BUTTON #}
    <a href={{ path('app_dashboard') }} class="border border-neutral-600 font-bold px-1 py-0 rounded mr-2 text-white" title="Back to dashboard">
        <i class="fa fa-arrow-left" aria-hidden="true"></i>
    </a>
    {# LINK TO METRICS DASHBOARD #}
    <a href={{ path('app_metrics_dashboard') }} class="border border-neutral-600 font-bold px-1 py-0 rounded mr-2 ml-1 text-white" title="Go to metrics dashboard">
        <i class="fa fa-chart-line" aria-hidden="true"></i>
    </a>
    {# LINK TO DIAGNOSTICS #}
    <a href={{ path('app_diagnostic') }} class="border border-neutral-600 font-bold px-1 py-0 rounded mr-2 ml-1 text-white" title="Go to diagnostics">
        <i class="fas fa-check" aria-hidden="true"></i>
    </a>
    <span class="mr-1 text-white">System Audit</span>
</div>

{# SYSTEM INFO CONTENT #}
<div class="w-full dashbard-component">
    {# SYSTEM INFO CARDS (INCLUDED FROM DASHBOARD) #}
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 p-2 component">
        {% include "component/dashboard/card/system-info-card.twig" %}
        {% include "component/dashboard/card/process-list-card.twig" %}
        {% include "component/system-audit/card/ufw-open-ports-card.twig" %}
    </div>

    {# SSH ACCESS HISTORY CARD #}
    <div class="p-2 mt-[-8px]">
        <div class="card-color custom-scrollbar border border-neutral-800 shadow-md rounded overflow-hidden w-full max-h-50 text-white">
            <div class="px-3 py-2 border-b border-neutral-800 text-white font-bold text-sm flex items-center justify-between">
                SSH access history
            </div>
            <div class="overflow-y-scroll max-h-72">
                {% if sshAccessHistory|length == 0 %}
                    <div class="text-center text-neutral-200 text-sm p-1">No SSH access history found</div>
                {% endif %}
                <ul>
                    {% for login in sshAccessHistory %}
                        <li>
                            <div class="flex items-center justify-between border-b border-neutral-800 pr-2 hover:bg-neutral-800">
                                <div class="flex items-center p-[5px] pt-[2px] pb-[2px]">
                                    <div class="flex flex-col">
                                        <div class="text-sm font-bold">{{ login.user }}</div>
                                        <div class="text-xs text-green-500">{{ login.date }}</div>
                                    </div>
                                </div>
                                {{ login.host }} - {{ login.ip }} - {{ login.port }}
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    {# SYSTEM LOGS CARD #}
    <div class="p-2 mt-[-8px]">
        <div class="card-color custom-scrollbar border border-neutral-800 shadow-md rounded overflow-hidden w-full max-h-50 text-white">
            <div class="px-3 py-2 border-b border-neutral-800 text-white font-bold text-sm flex items-center justify-between">
                System logs
            </div>
            <div class="overflow-y-scroll max-h-72 p-1">
                <ul class="space-y-[5px]">
                    {% for logFile in logFiles %}
                        <li>
                            <a href={{ path('app_file_system_view', { path: logFile.path, referer: 'app_system_audit' }) }} class="block p-3 bg-neutral-800 hover:bg-blue-700 break-words">{{ logFile.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    {# SYSTEM DIAGNOSTICS CARD #}
    <div class="p-2 mt-[-8px] component">
        {% include "component/diagnostic/card/system-diagnostics.twig" %}
    </div>
</div>
{% endblock %}
